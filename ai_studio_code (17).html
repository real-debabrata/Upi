<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QuickPay | UPI Link</title>
    <!-- QR Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #09090b;
            --card: #18181b;
            --border: #27272a;
            --primary: #6366f1;
            --text: #ffffff;
            --text-muted: #a1a1aa;
            --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-image: radial-gradient(circle at top center, #1e1b4b, transparent 40%);
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .logo {
            text-align: center;
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(to right, #6366f1, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Input Form Styles */
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem; }
        
        input {
            width: 100%;
            background: #000;
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus { border-color: var(--primary); }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }
        .btn:active { transform: scale(0.98); }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-muted); margin-top: 1rem; }

        /* Payment Card (Hidden by default) */
        #payment-card { display: none; text-align: center; }
        
        .qr-wrapper {
            background: white;
            padding: 1rem;
            border-radius: 16px;
            display: inline-block;
            margin: 1.5rem 0;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.2);
        }

        #qrcode img { display: block; }

        .payment-details {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .detail-row span:first-child { color: var(--text-muted); }
        .detail-row:last-child { margin-bottom: 0; font-weight: 600; color: var(--success); font-size: 1.1rem; }

        .share-box {
            margin-top: 1.5rem;
            background: #000;
            border: 1px dashed var(--border);
            padding: 1rem;
            border-radius: 12px;
        }
        .share-url {
            font-family: monospace;
            color: var(--primary);
            font-size: 0.85rem;
            word-break: break-all;
            margin-bottom: 0.5rem;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* Utility to hide/show sections */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo"><i class="ri-flashlight-fill"></i> QuickPay</div>

        <!-- STATE 1: GENERATOR FORM -->
        <div id="generator-form">
            <div class="form-group">
                <label>UPI ID (VPA) *</label>
                <input type="text" id="input-vpa" placeholder="username@oksbi">
            </div>
            <div class="form-group">
                <label>Payee Name *</label>
                <input type="text" id="input-name" placeholder="Name as per bank">
            </div>
            <div class="form-group">
                <label>Amount (Optional)</label>
                <input type="number" id="input-amount" placeholder="0.00">
            </div>
            <button class="btn btn-primary" onclick="createPaymentLink()">Generate Payment Link</button>
        </div>

        <!-- STATE 2: PAYMENT CARD (QR Display) -->
        <div id="payment-card">
            <div class="payment-details">
                <div class="detail-row">
                    <span>Paying To</span>
                    <span id="disp-name">...</span>
                </div>
                <div class="detail-row">
                    <span>UPI ID</span>
                    <span id="disp-vpa">...</span>
                </div>
                <div class="detail-row">
                    <span>Amount</span>
                    <span id="disp-amount">₹0.00</span>
                </div>
            </div>

            <div class="qr-wrapper">
                <div id="qrcode"></div>
            </div>

            <!-- Pay Button (Opens App) -->
            <a id="btn-pay-app" href="#" class="btn btn-primary" style="margin-bottom: 10px;">
                <i class="ri-smartphone-line"></i> Pay Now via App
            </a>

            <!-- Share Section -->
            <div class="share-box">
                <p style="color:var(--text-muted); font-size:0.8rem; margin-bottom:5px;">Share this page to request money:</p>
                <div class="share-url" id="share-url-text">https://...</div>
                <button class="btn btn-outline" style="padding: 0.5rem; margin-top: 5px; font-size: 0.9rem;" onclick="copyShareLink()">
                    <i class="ri-file-copy-line"></i> Copy Web Link
                </button>
            </div>

            <button class="btn btn-outline" onclick="resetApp()">Create New Link</button>
        </div>
    </div>

    <div class="toast" id="toast">Link Copied!</div>

    <script>
        const qr = new QRCode(document.getElementById("qrcode"), {
            width: 200,
            height: 200,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.M
        });

        // 1. ON LOAD: Check if URL has payment parameters
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('pa')) {
                // We are in "Payment Mode"
                const vpa = params.get('pa');
                const name = params.get('pn');
                const am = params.get('am');
                
                renderPaymentCard(vpa, name, am);
            }
        };

        // 2. LOGIC: Create Link (Generator Mode)
        function createPaymentLink() {
            const vpa = document.getElementById('input-vpa').value.trim();
            const name = document.getElementById('input-name').value.trim();
            const amount = document.getElementById('input-amount').value.trim();

            if (!vpa || !vpa.includes('@')) {
                alert("Valid UPI ID required");
                return;
            }
            if (!name) {
                alert("Payee Name is required");
                return;
            }

            // Update Browser URL without reloading (so the user can copy URL bar if they want)
            const newUrl = new URL(window.location.href);
            newUrl.searchParams.set('pa', vpa);
            newUrl.searchParams.set('pn', name);
            if(amount) newUrl.searchParams.set('am', amount);
            
            window.history.pushState({}, '', newUrl);

            // Render Card
            renderPaymentCard(vpa, name, amount);
        }

        // 3. CORE: Render the Payment Card & QR
        function renderPaymentCard(vpa, name, amount) {
            // Hide Form, Show Card
            document.getElementById('generator-form').classList.add('hidden');
            document.getElementById('payment-card').style.display = 'block';

            // Fill Details
            document.getElementById('disp-vpa').textContent = vpa;
            document.getElementById('disp-name').textContent = name;
            
            // Format Amount
            let finalAmount = "0";
            if (amount && !isNaN(amount)) {
                finalAmount = parseFloat(amount).toFixed(2);
                document.getElementById('disp-amount').textContent = "₹" + finalAmount;
            } else {
                document.getElementById('disp-amount').textContent = "Any Amount";
            }

            // --- Generate UPI Deep Link (for QR and Pay Button) ---
            // NOTE: We keep @ raw, but encode Name to handle spaces safely
            let upiLink = `upi://pay?pa=${vpa}&pn=${encodeURIComponent(name)}&cu=INR`;
            if (finalAmount !== "0") {
                upiLink += `&am=${finalAmount}`;
            }

            // Update QR
            qr.clear();
            qr.makeCode(upiLink);

            // Update Pay Button
            document.getElementById('btn-pay-app').href = upiLink;

            // Update Share Text
            document.getElementById('share-url-text').textContent = window.location.href;
        }

        // 4. UTILS
        function copyShareLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast("Web Link Copied!");
            });
        }

        function resetApp() {
            // Clear URL params
            const cleanUrl = window.location.origin + window.location.pathname;
            window.history.pushState({}, '', cleanUrl);
            
            // Reset UI
            document.getElementById('payment-card').style.display = 'none';
            document.getElementById('generator-form').classList.remove('hidden');
            
            // Clear inputs
            document.getElementById('input-vpa').value = '';
            document.getElementById('input-name').value = '';
            document.getElementById('input-amount').value = '';
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>